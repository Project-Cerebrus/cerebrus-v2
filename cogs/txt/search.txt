import discord, random
from discord.ext import commands
import subprocess
from googleapi import google
import os
import time
import asyncio
bot = commands.Bot(command_prefix = '_')

class search(commands.Cog, name='search'):
	def __init__(self, bot):
		self.bot = bot

@commands.command()
async def gle(self,ctx,*,args):
	dots = 1
	num_page = 1
	dp = 1
	async def ser(q, num_page):
			dots = 1
			search_results = google.search(q, num_page)
			while search_results == []:
					dots += 1 
					if dots == 0:
						q = await ctx.send("(|)loading")
					elif dots == 1:
						await q.edit("(/)loading.")
					elif dots == 2:
						await q.edit("(-)loading..")
					elif dots == 3:
						await q.edit("(\)loading...")
						dots = 0
					search_results = google.search(search, num_page)
			c()
			for result in search_results:
				await ctx.send(result.name)
				await ctx.send("description:",result.description)
				await ctx.send("link:",result.link)
				await ctx.send("page",num_page)
	def c():
			os.system("clear")
	while True:
			num_page = 1
			search = args
			q2 = await ctx.send("querying...")
			search_results = google.search(search, num_page)
			while search_results == []:
					
					c()
					
					dots += 1 
					if dots == 0:
							await q2.edit("(|)loading")
					elif dots == 1:
							await q2.edit("(/)loading.")
					elif dots == 2:
							await q2.edit("(-)loading..")
					elif dots == 3:
							await q2.edit("(\)loading...")
							
							dots = 0
					search_results = google.search(search, num_page)
			c()
			for result in search_results:
					ctx.end(result.name + "\ndescription: " + result.description + "\nlink: " + result.link)
					print()
					print("description:",result.description)
					print()
					print("link:",result.link)
			print()
			print("page:",num_page)
			while True:
					print("type n for new tab, np for next page and lp for last page")
					men2 = input(">")
					if men2 == "n":
							num_page = 1
							search = input("search google.py: ")
							print("querying...")
							search_results = google.search(search, num_page)
							while search_results == []:
									c()
									dots += 1 
									if dots == 0:
											print("(|)loading")
									elif dots == 1:
											print("(/)loading.")
									elif dots == 2:
											print("(-)loading..")
									elif dots == 3:
											print("(\)loading...")
											dots = 0
									search_results = google.search(search, num_page)
							c()
							for result in search_results:
									print(result.name)
									print()
									print("description:",result.description)
									print()
									print("link:",result.link)
							print()
							print("page number:",num_page)
					elif men2 == "np":
							dp += 1
							ser(search, dp)
					elif men2 == "lp":
							if dp != 0:
									dp -= 1
									ser(search,dp)
							else:
									dp = dp
									ser(search, dp)
						
def setup(bot):
    bot.add_cog(search(bot))